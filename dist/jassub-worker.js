"use strict";var Module=function(p={}){var p=p,h;p.ready=new Promise((r,t)=>{h=r});var w=r=>console.log(r),m=r=>console.error(r);function T(){h(p)}function F(r,t){if(!r)throw t}let C=null;w=r=>{r==="JASSUB: No usable fontconfig configuration file found, using fallback."?console.debug(r):console.log(r)},m=r=>{r==="Fontconfig error: Cannot load default config file: No such file: (null)"?console.debug(r):console.error(r)},Y=(r=>()=>{r(),self.wasmMemory=x,self.HEAPU8C=new Uint8ClampedArray(x.buffer),self.HEAPU8=new Uint8Array(x.buffer)})(Y),String.prototype.startsWith||(String.prototype.startsWith=function(r,t){return t===void 0&&(t=0),this.substring(t,r.length)===r}),String.prototype.includes||(String.prototype.includes=function(r,t){return this.indexOf(r,t)!==-1});function S(r){throw r}var j,E,k,O,G,R,fe,le,x,ue;function Y(){var r=x.buffer;j=new Int8Array(r),E=new Int16Array(r),k=new Int32Array(r),O=new Uint8Array(r),G=new Uint16Array(r),R=new Uint32Array(r),fe=new Float32Array(r),le=new Float64Array(r)}x=new WebAssembly.Memory({initial:256,maximum:32768}),Y();var ce=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function de(r,t,n){for(var s=t+n,o=t;r[o]&&!(o>=s);)++o;if(o-t>16&&r.buffer&&ce)return ce.decode(r.subarray(t,o));for(var l="";t<o;){var u=r[t++];if(!(u&128)){l+=String.fromCharCode(u);continue}var f=r[t++]&63;if((u&224)==192){l+=String.fromCharCode((u&31)<<6|f);continue}var v=r[t++]&63;if((u&240)==224?u=(u&15)<<12|f<<6|v:u=(u&7)<<18|f<<12|v<<6|r[t++]&63,u<65536)l+=String.fromCharCode(u);else{var g=u-65536;l+=String.fromCharCode(55296|g>>10,56320|g&1023)}}return l}function X(r,t){return r?de(O,r,t):""}function _e(r,t,n,s){S(`Assertion failed: ${X(r)}, at: `+[t?X(t):"unknown filename",n,s?X(s):"unknown function"])}function $e(r,t,n){return 0}function Te(r,t){}function Pe(r,t,n,s){if(!(s>0))return 0;for(var o=n,l=n+s-1,u=0;u<r.length;++u){var f=r.charCodeAt(u);if(f>=55296&&f<=57343){var v=r.charCodeAt(++u);f=65536+((f&1023)<<10)|v&1023}if(f<=127){if(n>=l)break;t[n++]=f}else if(f<=2047){if(n+1>=l)break;t[n++]=192|f>>6,t[n++]=128|f&63}else if(f<=65535){if(n+2>=l)break;t[n++]=224|f>>12,t[n++]=128|f>>6&63,t[n++]=128|f&63}else{if(n+3>=l)break;t[n++]=240|f>>18,t[n++]=128|f>>12&63,t[n++]=128|f>>6&63,t[n++]=128|f&63}}return t[n]=0,n-o}function Fe(r,t,n){return Pe(r,O,t,n)}function ir(r,t,n){}function ar(r,t,n){return 0}function or(r,t,n,s){}function fr(r,t,n,s){}function lr(r,t){}function ur(r,t,n,s,o){}function Ae(r){switch(r){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+r)}}function cr(){for(var r=new Array(256),t=0;t<256;++t)r[t]=String.fromCharCode(t);Ie=r}var Ie=void 0;function I(r){for(var t="",n=r;O[n];)t+=Ie[O[n++]];return t}var Q={},Z={},pe={},dr=48,pr=57;function Se(r){if(r===void 0)return"_unknown";r=r.replace(/[^a-zA-Z0-9_]/g,"$");var t=r.charCodeAt(0);return t>=dr&&t<=pr?"_"+r:r}function je(r,t){return r=Se(r),{[r]:function(){return t.apply(this,arguments)}}[r]}function Oe(r,t){var n=je(t,function(s){this.name=t,this.message=s;var o=new Error(s).stack;o!==void 0&&(this.stack=this.toString()+`
`+o.replace(/^Error(:[^\n]*)?\n/,""))});return n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return this.message===void 0?this.name:this.name+": "+this.message},n}var N=void 0;function _(r){throw new N(r)}var Le=void 0;function ge(r){throw new Le(r)}function K(r,t,n){r.forEach(function(f){pe[f]=t});function s(f){var v=n(f);v.length!==r.length&&ge("Mismatched type converter count");for(var g=0;g<r.length;++g)B(r[g],v[g])}var o=new Array(t.length),l=[],u=0;t.forEach((f,v)=>{Z.hasOwnProperty(f)?o[v]=Z[f]:(l.push(f),Q.hasOwnProperty(f)||(Q[f]=[]),Q[f].push(()=>{o[v]=Z[f],++u,u===l.length&&s(o)}))}),l.length===0&&s(o)}function B(r,t,n={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var s=t.name;if(r||_(`type "${s}" must have a positive integer typeid pointer`),Z.hasOwnProperty(r)){if(n.ignoreDuplicateRegistrations)return;_(`Cannot register type '${s}' twice`)}if(Z[r]=t,delete pe[r],Q.hasOwnProperty(r)){var o=Q[r];delete Q[r],o.forEach(l=>l())}}function gr(r,t,n,s,o){var l=Ae(n);t=I(t),B(r,{name:t,fromWireType:function(u){return!!u},toWireType:function(u,f){return f?s:o},argPackAdvance:8,readValueFromPointer:function(u){var f;if(n===1)f=j;else if(n===2)f=E;else if(n===4)f=k;else throw new TypeError("Unknown boolean type size: "+t);return this.fromWireType(f[u>>l])},destructorFunction:null})}function vr(r){if(!(this instanceof z)||!(r instanceof z))return!1;for(var t=this.$$.ptrType.registeredClass,n=this.$$.ptr,s=r.$$.ptrType.registeredClass,o=r.$$.ptr;t.baseClass;)n=t.upcast(n),t=t.baseClass;for(;s.baseClass;)o=s.upcast(o),s=s.baseClass;return t===s&&n===o}function hr(r){return{count:r.count,deleteScheduled:r.deleteScheduled,preservePointerOnDelete:r.preservePointerOnDelete,ptr:r.ptr,ptrType:r.ptrType,smartPtr:r.smartPtr,smartPtrType:r.smartPtrType}}function Ee(r){function t(n){return n.$$.ptrType.registeredClass.name}_(t(r)+" instance already deleted")}var ke=!1;function He(r){}function yr(r){r.smartPtr?r.smartPtrType.rawDestructor(r.smartPtr):r.ptrType.registeredClass.rawDestructor(r.ptr)}function xe(r){r.count.value-=1;var t=r.count.value===0;t&&yr(r)}function Be(r,t,n){if(t===n)return r;if(n.baseClass===void 0)return null;var s=Be(r,t,n.baseClass);return s===null?null:n.downcast(s)}var Ve={};function br(){return Object.keys(te).length}function mr(){var r=[];for(var t in te)te.hasOwnProperty(t)&&r.push(te[t]);return r}var ee=[];function Re(){for(;ee.length;){var r=ee.pop();r.$$.deleteScheduled=!1,r.delete()}}var re=void 0;function Cr(r){re=r,ee.length&&re&&re(Re)}function wr(){p.getInheritedInstanceCount=br,p.getLiveInheritedInstances=mr,p.flushPendingDeletes=Re,p.setDelayFunction=Cr}var te={};function _r(r,t){for(t===void 0&&_("ptr should not be undefined");r.baseClass;)t=r.upcast(t),r=r.baseClass;return t}function $r(r,t){return t=_r(r,t),te[t]}function ve(r,t){(!t.ptrType||!t.ptr)&&ge("makeClassHandle requires ptr and ptrType");var n=!!t.smartPtrType,s=!!t.smartPtr;return n!==s&&ge("Both smartPtrType and smartPtr must be specified"),t.count={value:1},ne(Object.create(r,{$$:{value:t}}))}function Tr(r){var t=this.getPointee(r);if(!t)return this.destructor(r),null;var n=$r(this.registeredClass,t);if(n!==void 0){if(n.$$.count.value===0)return n.$$.ptr=t,n.$$.smartPtr=r,n.clone();var s=n.clone();return this.destructor(r),s}function o(){return this.isSmartPointer?ve(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:r}):ve(this.registeredClass.instancePrototype,{ptrType:this,ptr:r})}var l=this.registeredClass.getActualType(t),u=Ve[l];if(!u)return o.call(this);var f;this.isConst?f=u.constPointerType:f=u.pointerType;var v=Be(t,this.registeredClass,f.registeredClass);return v===null?o.call(this):this.isSmartPointer?ve(f.registeredClass.instancePrototype,{ptrType:f,ptr:v,smartPtrType:this,smartPtr:r}):ve(f.registeredClass.instancePrototype,{ptrType:f,ptr:v})}function ne(r){return typeof FinalizationRegistry>"u"?(ne=t=>t,r):(ke=new FinalizationRegistry(t=>{xe(t.$$)}),ne=t=>{var n=t.$$,s=!!n.smartPtr;if(s){var o={$$:n};ke.register(t,o,t)}return t},He=t=>ke.unregister(t),ne(r))}function Pr(){if(this.$$.ptr||Ee(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var r=ne(Object.create(Object.getPrototypeOf(this),{$$:{value:hr(this.$$)}}));return r.$$.count.value+=1,r.$$.deleteScheduled=!1,r}function Fr(){this.$$.ptr||Ee(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_("Object already scheduled for deletion"),He(this),xe(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Ar(){return!this.$$.ptr}function Sr(){return this.$$.ptr||Ee(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_("Object already scheduled for deletion"),ee.push(this),ee.length===1&&re&&re(Re),this.$$.deleteScheduled=!0,this}function jr(){z.prototype.isAliasOf=vr,z.prototype.clone=Pr,z.prototype.delete=Fr,z.prototype.isDeleted=Ar,z.prototype.deleteLater=Sr}function z(){}function Je(r,t,n){if(r[t].overloadTable===void 0){var s=r[t];r[t]=function(){return r[t].overloadTable.hasOwnProperty(arguments.length)||_(`Function '${n}' called with an invalid number of arguments (${arguments.length}) - expects one of (${r[t].overloadTable})!`),r[t].overloadTable[arguments.length].apply(this,arguments)},r[t].overloadTable=[],r[t].overloadTable[s.argCount]=s}}function Or(r,t,n){p.hasOwnProperty(r)?((n===void 0||p[r].overloadTable!==void 0&&p[r].overloadTable[n]!==void 0)&&_(`Cannot register public name '${r}' twice`),Je(p,r,r),p.hasOwnProperty(n)&&_(`Cannot register multiple overloads of a function with the same number of arguments (${n})!`),p[r].overloadTable[n]=t):(p[r]=t,n!==void 0&&(p[r].numArguments=n))}function Er(r,t,n,s,o,l,u,f){this.name=r,this.constructor=t,this.instancePrototype=n,this.rawDestructor=s,this.baseClass=o,this.getActualType=l,this.upcast=u,this.downcast=f,this.pureVirtualFunctions=[]}function he(r,t,n){for(;t!==n;)t.upcast||_(`Expected null or instance of ${n.name}, got an instance of ${t.name}`),r=t.upcast(r),t=t.baseClass;return r}function kr(r,t){if(t===null)return this.isReference&&_("null is not a valid "+this.name),0;t.$$||_(`Cannot pass "${De(t)}" as a ${this.name}`),t.$$.ptr||_("Cannot pass deleted object as a pointer of type "+this.name);var n=t.$$.ptrType.registeredClass,s=he(t.$$.ptr,n,this.registeredClass);return s}function Rr(r,t){var n;if(t===null)return this.isReference&&_("null is not a valid "+this.name),this.isSmartPointer?(n=this.rawConstructor(),r!==null&&r.push(this.rawDestructor,n),n):0;t.$$||_(`Cannot pass "${De(t)}" as a ${this.name}`),t.$$.ptr||_(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&t.$$.ptrType.isConst&&_(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);var s=t.$$.ptrType.registeredClass;if(n=he(t.$$.ptr,s,this.registeredClass),this.isSmartPointer)switch(t.$$.smartPtr===void 0&&_("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?n=t.$$.smartPtr:_(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:n=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)n=t.$$.smartPtr;else{var o=t.clone();n=this.rawShare(n,Me.toHandle(function(){o.delete()})),r!==null&&r.push(this.rawDestructor,n)}break;default:_("Unsupporting sharing policy")}return n}function Mr(r,t){if(t===null)return this.isReference&&_("null is not a valid "+this.name),0;t.$$||_(`Cannot pass "${De(t)}" as a ${this.name}`),t.$$.ptr||_(`Cannot pass deleted object as a pointer of type ${this.name}`),t.$$.ptrType.isConst&&_(`Cannot convert argument of type ${t.$$.ptrType.name} to parameter type ${this.name}`);var n=t.$$.ptrType.registeredClass,s=he(t.$$.ptr,n,this.registeredClass);return s}function ye(r){return this.fromWireType(k[r>>2])}function Dr(r){return this.rawGetPointee&&(r=this.rawGetPointee(r)),r}function Wr(r){this.rawDestructor&&this.rawDestructor(r)}function Ur(r){r!==null&&r.delete()}function Ir(){V.prototype.getPointee=Dr,V.prototype.destructor=Wr,V.prototype.argPackAdvance=8,V.prototype.readValueFromPointer=ye,V.prototype.deleteObject=Ur,V.prototype.fromWireType=Tr}function V(r,t,n,s,o,l,u,f,v,g,y){this.name=r,this.registeredClass=t,this.isReference=n,this.isConst=s,this.isSmartPointer=o,this.pointeeType=l,this.sharingPolicy=u,this.rawGetPointee=f,this.rawConstructor=v,this.rawShare=g,this.rawDestructor=y,!o&&t.baseClass===void 0?s?(this.toWireType=kr,this.destructorFunction=null):(this.toWireType=Mr,this.destructorFunction=null):this.toWireType=Rr}function Lr(r,t,n){p.hasOwnProperty(r)||ge("Replacing nonexistant public symbol"),p[r].overloadTable!==void 0&&n!==void 0?p[r].overloadTable[n]=t:(p[r]=t,p[r].argCount=n)}function Hr(r,t,n){var s=dynCalls[r];return n&&n.length?s.apply(null,[t].concat(n)):s.call(null,t)}var be=[];function se(r){var t=be[r];return t||(r>=be.length&&(be.length=r+1),be[r]=t=ue.get(r)),t}function xr(r,t,n){if(r.includes("j"))return Hr(r,t,n);var s=se(t).apply(null,n);return s}function Br(r,t){var n=[];return function(){return n.length=0,Object.assign(n,arguments),xr(r,t,n)}}function q(r,t){r=I(r);function n(){return r.includes("j")?Br(r,t):se(t)}var s=n();return typeof s!="function"&&_(`unknown function pointer with signature ${r}: ${t}`),s}var Ge=void 0;function Vr(r){var t=Ne(r),n=I(t);return J(t),n}function ie(r,t){var n=[],s={};function o(l){if(!s[l]&&!Z[l]){if(pe[l]){pe[l].forEach(o);return}n.push(l),s[l]=!0}}throw t.forEach(o),new Ge(r+": "+n.map(Vr).join([", "]))}function Jr(r,t,n,s,o,l,u,f,v,g,y,$,P){y=I(y),l=q(o,l),f&&(f=q(u,f)),g&&(g=q(v,g)),P=q($,P);var A=Se(y);Or(A,function(){ie(`Cannot construct ${y} due to unbound types`,[s])}),K([r,t,n],s?[s]:[],function(M){M=M[0];var W,D;s?(W=M.registeredClass,D=W.instancePrototype):D=z.prototype;var L=je(A,function(){if(Object.getPrototypeOf(this)!==oe)throw new N("Use 'new' to construct "+y);if(U.constructor_body===void 0)throw new N(y+" has no accessible constructor");var sr=U.constructor_body[arguments.length];if(sr===void 0)throw new N(`Tried to invoke ctor of ${y} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(U.constructor_body).toString()}) parameters instead!`);return sr.apply(this,arguments)}),oe=Object.create(D,{constructor:{value:L}});L.prototype=oe;var U=new Er(y,L,oe,P,W,l,f,g);U.baseClass&&(U.baseClass.__derivedClasses===void 0&&(U.baseClass.__derivedClasses=[]),U.baseClass.__derivedClasses.push(U));var Lt=new V(y,U,!0,!1,!1),tr=new V(y+"*",U,!1,!1,!1),nr=new V(y+" const*",U,!1,!0,!1);return Ve[r]={pointerType:tr,constPointerType:nr},Lr(A,L),[Lt,tr,nr]})}function ze(r,t){for(var n=[],s=0;s<r;s++)n.push(R[t+s*4>>2]);return n}function qe(r){for(;r.length;){var t=r.pop(),n=r.pop();n(t)}}function Gr(r,t){if(!(r instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof r} which is not a function`);var n=je(r.name||"unknownFunctionName",function(){});n.prototype=r.prototype;var s=new n,o=r.apply(s,t);return o instanceof Object?o:s}function Ke(r,t,n,s,o,l){var u=t.length;u<2&&_("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var f=t[1]!==null&&n!==null,v=!1,g=1;g<t.length;++g)if(t[g]!==null&&t[g].destructorFunction===void 0){v=!0;break}for(var y=t[0].name!=="void",$="",P="",g=0;g<u-2;++g)$+=(g!==0?", ":"")+"arg"+g,P+=(g!==0?", ":"")+"arg"+g+"Wired";var A="return function "+Se(r)+"("+$+`) {
if (arguments.length !== `+(u-2)+`) {
throwBindingError('function `+r+" called with ' + arguments.length + ' arguments, expected "+(u-2)+` args!');
}
`;v&&(A+=`var destructors = [];
`);var M=v?"destructors":"null",W=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],D=[_,s,o,qe,t[0],t[1]];f&&(A+="var thisWired = classParam.toWireType("+M+`, this);
`);for(var g=0;g<u-2;++g)A+="var arg"+g+"Wired = argType"+g+".toWireType("+M+", arg"+g+"); // "+t[g+2].name+`
`,W.push("argType"+g),D.push(t[g+2]);if(f&&(P="thisWired"+(P.length>0?", ":"")+P),A+=(y||l?"var rv = ":"")+"invoker(fn"+(P.length>0?", ":"")+P+`);
`,v)A+=`runDestructors(destructors);
`;else for(var g=f?1:2;g<t.length;++g){var L=g===1?"thisWired":"arg"+(g-2)+"Wired";t[g].destructorFunction!==null&&(A+=L+"_dtor("+L+"); // "+t[g].name+`
`,W.push(L+"_dtor"),D.push(t[g].destructorFunction))}return y&&(A+=`var ret = retType.fromWireType(rv);
return ret;
`),A+=`}
`,W.push(A),Gr(Function,W).apply(null,D)}function zr(r,t,n,s,o,l){F(t>0);var u=ze(t,n);o=q(s,o),K([],[r],function(f){f=f[0];var v="constructor "+f.name;if(f.registeredClass.constructor_body===void 0&&(f.registeredClass.constructor_body=[]),f.registeredClass.constructor_body[t-1]!==void 0)throw new N(`Cannot register multiple constructors with identical number of parameters (${t-1}) for class '${f.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return f.registeredClass.constructor_body[t-1]=()=>{ie(`Cannot construct ${f.name} due to unbound types`,u)},K([],u,function(g){return g.splice(1,0,null),f.registeredClass.constructor_body[t-1]=Ke(v,g,null,o,l),[]}),[]})}function qr(r,t,n,s,o,l,u,f,v){var g=ze(n,s);t=I(t),l=q(o,l),K([],[r],function(y){y=y[0];var $=y.name+"."+t;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),f&&y.registeredClass.pureVirtualFunctions.push(t);function P(){ie(`Cannot call ${$} due to unbound types`,g)}var A=y.registeredClass.instancePrototype,M=A[t];return M===void 0||M.overloadTable===void 0&&M.className!==y.name&&M.argCount===n-2?(P.argCount=n-2,P.className=y.name,A[t]=P):(Je(A,t,$),A[t].overloadTable[n-2]=P),K([],g,function(W){var D=Ke($,W,y,l,u,v);return A[t].overloadTable===void 0?(D.argCount=n-2,A[t]=D):A[t].overloadTable[n-2]=D,[]}),[]})}function Ye(r,t,n){return r instanceof Object||_(n+' with invalid "this": '+r),r instanceof t.registeredClass.constructor||_(n+' incompatible with "this" of type '+r.constructor.name),r.$$.ptr||_(`cannot call emscripten binding method ${n} on deleted object`),he(r.$$.ptr,r.$$.ptrType.registeredClass,t.registeredClass)}function Kr(r,t,n,s,o,l,u,f,v,g){t=I(t),o=q(s,o),K([],[r],function(y){y=y[0];var $=y.name+"."+t,P={get:function(){ie(`Cannot access ${$} due to unbound types`,[n,u])},enumerable:!0,configurable:!0};return v?P.set=()=>{ie(`Cannot access ${$} due to unbound types`,[n,u])}:P.set=A=>{_($+" is a read-only property")},Object.defineProperty(y.registeredClass.instancePrototype,t,P),K([],v?[n,u]:[n],function(A){var M=A[0],W={get:function(){var L=Ye(this,y,$+" getter");return M.fromWireType(o(l,L))},enumerable:!0};if(v){v=q(f,v);var D=A[1];W.set=function(L){var oe=Ye(this,y,$+" setter"),U=[];v(g,oe,D.toWireType(U,L)),qe(U)}}return Object.defineProperty(y.registeredClass.instancePrototype,t,W),[]}),[]})}function Yr(){this.allocated=[void 0],this.freelist=[],this.get=function(r){return this.allocated[r]},this.allocate=function(r){var t=this.freelist.pop()||this.allocated.length;return this.allocated[t]=r,t},this.free=function(r){this.allocated[r]=void 0,this.freelist.push(r)}}var H=new Yr;function Xr(r){r>=H.reserved&&--H.get(r).refcount===0&&H.free(r)}function Qr(){for(var r=0,t=H.reserved;t<H.allocated.length;++t)H.allocated[t]!==void 0&&++r;return r}function Zr(){H.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),H.reserved=H.allocated.length,p.count_emval_handles=Qr}var Me={toValue:r=>(r||_("Cannot use deleted val. handle = "+r),H.get(r).value),toHandle:r=>{switch(r){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return H.allocate({refcount:1,value:r})}}};function Nr(r,t){t=I(t),B(r,{name:t,fromWireType:function(n){var s=Me.toValue(n);return Xr(n),s},toWireType:function(n,s){return Me.toHandle(s)},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:null})}function De(r){if(r===null)return"null";var t=typeof r;return t==="object"||t==="array"||t==="function"?r.toString():""+r}function et(r,t){switch(t){case 2:return function(n){return this.fromWireType(fe[n>>2])};case 3:return function(n){return this.fromWireType(le[n>>3])};default:throw new TypeError("Unknown float type: "+r)}}function rt(r,t,n){var s=Ae(n);t=I(t),B(r,{name:t,fromWireType:function(o){return o},toWireType:function(o,l){return l},argPackAdvance:8,readValueFromPointer:et(t,s),destructorFunction:null})}function tt(r,t,n){switch(t){case 0:return n?function(o){return j[o]}:function(o){return O[o]};case 1:return n?function(o){return E[o>>1]}:function(o){return G[o>>1]};case 2:return n?function(o){return k[o>>2]}:function(o){return R[o>>2]};default:throw new TypeError("Unknown integer type: "+r)}}function nt(r,t,n,s,o){t=I(t);var l=Ae(n),u=$=>$;if(s===0){var f=32-8*n;u=$=>$<<f>>>f}var v=t.includes("unsigned"),g=($,P)=>{},y;v?y=function($,P){return g(P,this.name),P>>>0}:y=function($,P){return g(P,this.name),P},B(r,{name:t,fromWireType:u,toWireType:y,argPackAdvance:8,readValueFromPointer:tt(t,l,s!==0),destructorFunction:null})}function st(r,t,n){var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],o=s[t];function l(u){u=u>>2;var f=R,v=f[u],g=f[u+1];return new o(f.buffer,g,v)}n=I(n),B(r,{name:n,fromWireType:l,argPackAdvance:8,readValueFromPointer:l},{ignoreDuplicateRegistrations:!0})}function it(r){for(var t=0,n=0;n<r.length;++n){var s=r.charCodeAt(n);s<=127?t++:s<=2047?t+=2:s>=55296&&s<=57343?(t+=4,++n):t+=3}return t}function at(r,t){t=I(t);var n=t==="std::string";B(r,{name:t,fromWireType:function(s){var o=R[s>>2],l=s+4,u;if(n)for(var f=l,v=0;v<=o;++v){var g=l+v;if(v==o||O[g]==0){var y=g-f,$=X(f,y);u===void 0?u=$:(u+=String.fromCharCode(0),u+=$),f=g+1}}else{for(var P=new Array(o),v=0;v<o;++v)P[v]=String.fromCharCode(O[l+v]);u=P.join("")}return J(s),u},toWireType:function(s,o){o instanceof ArrayBuffer&&(o=new Uint8Array(o));var l,u=typeof o=="string";u||o instanceof Uint8Array||o instanceof Uint8ClampedArray||o instanceof Int8Array||_("Cannot pass non-string to std::string"),n&&u?l=it(o):l=o.length;var f=Ue(4+l+1),v=f+4;if(R[f>>2]=l,n&&u)Fe(o,v,l+1);else if(u)for(var g=0;g<l;++g){var y=o.charCodeAt(g);y>255&&(J(v),_("String has UTF-16 code units that do not fit in 8 bits")),O[v+g]=y}else for(var g=0;g<l;++g)O[v+g]=o[g];return s!==null&&s.push(J,f),f},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:function(s){J(s)}})}var Xe=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0;function ot(r,t){for(var n=r,s=n>>1,o=s+t/2;!(s>=o)&&G[s];)++s;if(n=s<<1,n-r>32&&Xe)return Xe.decode(O.subarray(r,n));for(var l="",u=0;!(u>=t/2);++u){var f=E[r+u*2>>1];if(f==0)break;l+=String.fromCharCode(f)}return l}function ft(r,t,n){if(n===void 0&&(n=2147483647),n<2)return 0;n-=2;for(var s=t,o=n<r.length*2?n/2:r.length,l=0;l<o;++l){var u=r.charCodeAt(l);E[t>>1]=u,t+=2}return E[t>>1]=0,t-s}function lt(r){return r.length*2}function ut(r,t){for(var n=0,s="";!(n>=t/4);){var o=k[r+n*4>>2];if(o==0)break;if(++n,o>=65536){var l=o-65536;s+=String.fromCharCode(55296|l>>10,56320|l&1023)}else s+=String.fromCharCode(o)}return s}function ct(r,t,n){if(n===void 0&&(n=2147483647),n<4)return 0;for(var s=t,o=s+n-4,l=0;l<r.length;++l){var u=r.charCodeAt(l);if(u>=55296&&u<=57343){var f=r.charCodeAt(++l);u=65536+((u&1023)<<10)|f&1023}if(k[t>>2]=u,t+=4,t+4>o)break}return k[t>>2]=0,t-s}function dt(r){for(var t=0,n=0;n<r.length;++n){var s=r.charCodeAt(n);s>=55296&&s<=57343&&++n,t+=4}return t}function pt(r,t,n){n=I(n);var s,o,l,u,f;t===2?(s=ot,o=ft,u=lt,l=()=>G,f=1):t===4&&(s=ut,o=ct,u=dt,l=()=>R,f=2),B(r,{name:n,fromWireType:function(v){for(var g=R[v>>2],y=l(),$,P=v+4,A=0;A<=g;++A){var M=v+4+A*t;if(A==g||y[M>>f]==0){var W=M-P,D=s(P,W);$===void 0?$=D:($+=String.fromCharCode(0),$+=D),P=M+t}}return J(v),$},toWireType:function(v,g){typeof g!="string"&&_("Cannot pass non-string to C++ string type "+n);var y=u(g),$=Ue(4+y+t);return R[$>>2]=y>>f,o(g,$+4,y+t),v!==null&&v.push(J,$),$},argPackAdvance:8,readValueFromPointer:ye,destructorFunction:function(v){J(v)}})}function gt(r,t){t=I(t),B(r,{isVoid:!0,name:t,argPackAdvance:0,fromWireType:function(){},toWireType:function(n,s){}})}function vt(){throw 1/0}function ht(r,t,n,s,o,l,u){return-52}function yt(r,t,n,s,o,l){}function bt(){S("")}var Qe;Qe=()=>performance.now();function mt(){return 2147483648}function Ct(r){var t=x.buffer;try{return x.grow(r-t.byteLength+65535>>>16),Y(),1}catch{}}function wt(r){var t=O.length;r=r>>>0;var n=mt();if(r>n)return!1;for(var s=(v,g)=>v+(g-v%g)%g,o=1;o<=4;o*=2){var l=t*(1+.2/o);l=Math.min(l,r+100663296);var u=Math.min(n,s(Math.max(r,l),65536)),f=Ct(u);if(f)return!0}return!1}var We={};function _t(){return"./this.program"}function ae(){if(!ae.strings){var r=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:r,_:_t()};for(var n in We)We[n]===void 0?delete t[n]:t[n]=We[n];var s=[];for(var n in t)s.push(n+"="+t[n]);ae.strings=s}return ae.strings}function $t(r,t){for(var n=0;n<r.length;++n)j[t++>>0]=r.charCodeAt(n);j[t>>0]=0}function Tt(r,t){var n=0;return ae().forEach(function(s,o){var l=t+n;R[r+o*4>>2]=l,$t(s,l),n+=s.length+1}),0}function Pt(r,t){var n=ae();R[r>>2]=n.length;var s=0;return n.forEach(function(o){s+=o.length+1}),R[t>>2]=s,0}function Ft(r){throw"exit("+r+")"}var At=Ft;function St(r){return 52}function jt(r,t,n,s){return 52}function Ot(r,t,n,s,o){return 70}var Et=[null,[],[]];function kt(r,t){var n=Et[r];t===0||t===10?((r===1?w:m)(de(n,0)),n.length=0):n.push(t)}function Rt(r,t,n,s){for(var o=0,l=0;l<n;l++){var u=R[t>>2],f=R[t+4>>2];t+=8;for(var v=0;v<f;v++)kt(r,O[u+v]);o+=f}return R[s>>2]=o,0}cr(),N=p.BindingError=Oe(Error,"BindingError"),Le=p.InternalError=Oe(Error,"InternalError"),jr(),wr(),Ir(),Ge=p.UnboundTypeError=Oe(Error,"UnboundTypeError"),Zr();var Mt={b:_e,k:$e,I:Te,B:ir,K:ar,G:or,n:fr,H:lr,u:ur,r:gr,j:Jr,A:zr,d:qr,c:Kr,L:Nr,p:rt,g:nt,e:st,q:at,l:pt,s:gt,y:vt,C:ht,D:yt,f:bt,m:Qe,z:wt,E:Tt,F:Pt,h:At,i:St,o:jt,t:Ot,J:Rt,x:Dt,v:Ut,w:Wt,a:x};function Dt(r,t,n){var s=Ce();try{return se(r)(t,n)}catch(o){if(we(s),o!==o+0)throw o;me(1,0)}}function Wt(r,t,n,s,o){var l=Ce();try{return se(r)(t,n,s,o)}catch(u){if(we(l),u!==u+0)throw u;me(1,0)}}function Ut(r,t,n,s){var o=Ce();try{return se(r)(t,n,s)}catch(l){if(we(o),l!==l+0)throw l;me(1,0)}}p.getTempRet0=rr,p.setTempRet0=er;function It(r){r.M()}var Ze={a:Mt},Ue,J,Ne,me,er,rr,Ce,we;return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(fetch("jassub-worker-modern.wasm"),Ze):WebAssembly.instantiate(p.wasm,Ze)).then(function(r){C=(r.instance||r).exports,p._malloc=Ue=C.N,J=C.O,Ne=C.P,p.__embind_initialize_bindings=C.Q,me=C.S,er=C.T,rr=C.U,Ce=C.V,we=C.W,C.X,C.Y,C.Z,C._,ue=C.R,It(C),T()}),p.ready};const read_=(i,p)=>{const h=new XMLHttpRequest;return h.open("GET",i,!1),h.responseType=p?"arraybuffer":"text",h.send(null),h.response},readAsync=(i,p,h)=>{const w=new XMLHttpRequest;w.open("GET",i,!0),w.responseType="arraybuffer",w.onload=()=>{if((w.status===200||w.status===0)&&w.response)return p(w.response)},w.onerror=h,w.send(null)};Date.now||(Date.now=()=>new Date().getTime());"performance"in self||(self.performance={now:()=>Date.now()});if(typeof console>"u"){const i=(p,h)=>{postMessage({target:"console",command:p,content:JSON.stringify(Array.prototype.slice.call(h))})};console={log:function(){i("log",arguments)},debug:function(){i("debug",arguments)},info:function(){i("info",arguments)},warn:function(){i("warn",arguments)},error:function(){i("error",arguments)}},console.log("Detected lack of console, overridden console")}try{const i=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(!(i instanceof WebAssembly.Module)||!(new WebAssembly.Instance(i)instanceof WebAssembly.Instance))throw new Error("WASM not supported")}catch(e){console.warn(e),eval(read_("jassub-worker.wasm.js"))}let lastCurrentTime=0;const rate=1;let rafId=null,nextIsRaf=!1,lastCurrentTimeReceivedAt=Date.now(),targetFps=24,useLocalFonts=!1,blendMode="js",availableFonts={};const fontMap_={};let fontId=0,debug;self.width=0;self.height=0;let asyncRender=!1;self.addFont=({font:i})=>asyncWrite(i);const findAvailableFonts=i=>{i=i.trim().toLowerCase(),i.startsWith("@")&&(i=i.substring(1)),!fontMap_[i]&&(fontMap_[i]=!0,availableFonts[i]?asyncWrite(availableFonts[i]):useLocalFonts&&postMessage({target:"getLocalFont",font:i}))},asyncWrite=i=>{typeof i=="string"?readAsync(i,p=>{allocFont(new Uint8Array(p))},console.error):allocFont(i)},allocFont=i=>{const p=_malloc(i.byteLength);self.HEAPU8.set(i,p),jassubObj.addFont("font-"+fontId++,p,i.byteLength),jassubObj.reloadFonts()},processAvailableFonts=i=>{if(!availableFonts)return;const p=parseAss(i);for(let m=0;m<p.length;m++)for(let T=0;T<p[m].body.length;T++)p[m].body[T].key==="Style"&&findAvailableFonts(p[m].body[T].value.Fontname);const h=/\\fn([^\\}]*?)[\\}]/g;let w;for(;(w=h.exec(i))!==null;)findAvailableFonts(w[1])};self.setTrack=({content:i})=>{processAvailableFonts(i),dropAllBlur&&(i=dropBlur(i)),jassubObj.createTrackMem(i),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],postMessage({target:"verifyColorSpace",subtitleColorSpace})};self.getColorSpace=()=>postMessage({target:"verifyColorSpace",subtitleColorSpace});self.freeTrack=()=>{jassubObj.removeTrack()};self.setTrackByUrl=({url:i})=>{self.setTrack({content:read_(i)})};const getCurrentTime=()=>{const i=(Date.now()-lastCurrentTimeReceivedAt)/1e3;return _isPaused?lastCurrentTime:(i>5&&(console.error("Didn't received currentTime > 5 seconds. Assuming video was paused."),setIsPaused(!0)),lastCurrentTime+i*rate)},setCurrentTime=i=>{lastCurrentTime=i,lastCurrentTimeReceivedAt=Date.now(),rafId||(nextIsRaf?rafId=requestAnimationFrame(renderLoop):(renderLoop(),setTimeout(()=>{nextIsRaf=!1},20)))};let _isPaused=!0;const setIsPaused=i=>{i!==_isPaused&&(_isPaused=i,i?rafId&&(clearTimeout(rafId),rafId=null):(lastCurrentTimeReceivedAt=Date.now(),rafId=requestAnimationFrame(renderLoop)))},a="BT601",b="BT709",c="SMPTE240M",d="FCC",libassYCbCrMap=[null,a,null,a,a,b,b,c,c,d,d],render=(i,p)=>{const h={},w=performance.now(),m=blendMode==="wasm"?jassubObj.renderBlend(i,p||0):jassubObj.renderImage(i,p||0);if(debug){const T=performance.now(),F=jassubObj.time;h.WASMRenderTime=F-w,h.WASMBitmapDecodeTime=T-F,h.JSRenderTime=Date.now()}if(jassubObj.changed!==0||p){const T=[],F=[];if(!m)return paintImages({images:T,buffers:F,times:h});if(asyncRender){const C=[];for(let S=m,j=0;j<jassubObj.count;S=S.next,++j){const E={w:S.w,h:S.h,x:S.x,y:S.y},k=S.image;C.push(createImageBitmap(new ImageData(self.HEAPU8C.subarray(k,k+E.w*E.h*4),E.w,E.h))),T.push(E)}Promise.all(C).then(S=>{for(let j=0;j<T.length;j++)T[j].image=S[j];debug&&(h.JSBitmapGenerationTime=Date.now()-h.JSRenderTime),paintImages({images:T,buffers:S,times:h})})}else{for(let C=m,S=0;S<jassubObj.count;C=C.next,++S){const j={w:C.w,h:C.h,x:C.x,y:C.y,image:C.image};if(!offCanvasCtx){const E=self.wasmMemory.buffer.slice(C.image,C.image+C.w*C.h*4);F.push(E),j.image=E}T.push(j)}paintImages({images:T,buffers:F,times:h})}}else postMessage({target:"unbusy"})};self.demand=({time:i})=>{lastCurrentTime=i,render(i)};const renderLoop=i=>{rafId=0,render(getCurrentTime(),i),_isPaused||(rafId=requestAnimationFrame(renderLoop))},paintImages=({times:i,images:p,buffers:h})=>{const w={target:"render",asyncRender,images:p,times:i,width:self.width,height:self.height,colorSpace:subtitleColorSpace};if(offscreenRender){(offCanvas.height!==self.height||offCanvas.width!==self.width)&&(offCanvas.width=self.width,offCanvas.height=self.height),offCanvasCtx.clearRect(0,0,self.width,self.height);for(const m of p)m.image&&(asyncRender?(offCanvasCtx.drawImage(m.image,m.x,m.y),m.image.close()):(bufferCanvas.width=m.w,bufferCanvas.height=m.h,bufferCtx.putImageData(new ImageData(self.HEAPU8C.subarray(m.image,m.image+m.w*m.h*4),m.w,m.h),0,0),offCanvasCtx.drawImage(bufferCanvas,m.x,m.y)));if(offscreenRender==="hybrid"){if(!p.length)return postMessage(w);debug&&(i.bitmaps=p.length);try{const m=offCanvas.transferToImageBitmap();w.images=[{image:m,x:0,y:0}],w.asyncRender=!0,postMessage(w,[m])}catch{postMessage({target:"unbusy"})}}else{if(debug){i.JSRenderTime=Date.now()-i.JSRenderTime-(i.JSBitmapGenerationTime||0);let m=0;for(const T in i)m+=i[T];console.log("Bitmaps: "+p.length+" Total: "+(m|0)+"ms",i)}postMessage({target:"unbusy"})}}else postMessage(w,h)},parseAss=i=>{let p,h,w,m,T,F,C,S,j,E;const k=[],O=i.split(/[\r\n]+/g);for(S=0;S<O.length;S++)if(p=O[S].match(/^\[(.*)\]$/),p)h=null,k.push({name:p[1],body:[]});else{if(/^\s*$/.test(O[S])||k.length===0)continue;if(E=k[k.length-1].body,O[S][0]===";")E.push({type:"comment",value:O[S].substring(1)});else{if(m=O[S].split(":"),T=m[0],F=m.slice(1).join(":").trim(),(h||T==="Format")&&(F=F.split(","),h&&F.length>h.length&&(w=F.slice(h.length-1).join(","),F=F.slice(0,h.length-1),F.push(w)),F=F.map(G=>G.trim()),h)){for(C={},j=0;j<F.length;j++)C[h[j]]=F[j];F=C}T==="Format"&&(h=F),E.push({key:T,value:F})}}return k},blurRegex=/\\blur(?:[0-9]+\.)?[0-9]+/gm,dropBlur=i=>i.replace(blurRegex,""),requestAnimationFrame=(()=>{let i=0;return p=>{const h=Date.now();if(i===0)i=h+1e3/targetFps;else for(;h+2>=i;)i+=1e3/targetFps;const w=Math.max(i-h,0);return setTimeout(p,w)}})(),_applyKeys=(i,p)=>{for(const h of Object.keys(i))p[h]=i[h]};let offCanvas,offCanvasCtx,offscreenRender,bufferCanvas,bufferCtx,jassubObj,subtitleColorSpace,dropAllBlur,_malloc;self.init=i=>{const p=fetch,h=!WebAssembly.instantiateStreaming&&read_(i.legacyWasmUrl,!0);WebAssembly.instantiateStreaming&&(self.fetch=w=>p(i.wasmUrl)),Module({wasm:h}).then(w=>{_malloc=w._malloc,self.width=i.width,self.height=i.height,blendMode=i.blendMode,asyncRender=i.asyncRender,asyncRender&&typeof createImageBitmap>"u"&&(asyncRender=!1,console.error("'createImageBitmap' needed for 'asyncRender' unsupported!")),availableFonts=i.availableFonts,debug=i.debug,targetFps=i.targetFps||targetFps,useLocalFonts=i.useLocalFonts,dropAllBlur=i.dropAllBlur;const m=i.fallbackFont.toLowerCase();jassubObj=new w.JASSUB(self.width,self.height,m||null,debug),m&&findAvailableFonts(m);let T=i.subContent;T||(T=read_(i.subUrl)),processAvailableFonts(T),dropAllBlur&&(T=dropBlur(T));for(const F of i.fonts||[])asyncWrite(F);jassubObj.createTrackMem(T),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],jassubObj.setDropAnimations(i.dropAllAnimations||0),(i.libassMemoryLimit>0||i.libassGlyphLimit>0)&&jassubObj.setMemoryLimits(i.libassGlyphLimit||0,i.libassMemoryLimit||0),postMessage({target:"ready"}),postMessage({target:"verifyColorSpace",subtitleColorSpace})})};self.offscreenCanvas=({transferable:i})=>{offCanvas=i[0],offCanvasCtx=offCanvas.getContext("2d"),asyncRender||(bufferCanvas=new OffscreenCanvas(self.height,self.width),bufferCtx=bufferCanvas.getContext("2d",{desynchronized:!0})),offscreenRender=!0};self.detachOffscreen=()=>{offCanvas=new OffscreenCanvas(self.height,self.width),offCanvasCtx=offCanvas.getContext("2d",{desynchronized:!0}),offscreenRender="hybrid"};self.canvas=({width:i,height:p,force:h})=>{if(i==null)throw new Error("Invalid canvas size specified");self.width=i,self.height=p,jassubObj.resizeCanvas(i,p),h&&render(lastCurrentTime,!0)};self.video=({currentTime:i,isPaused:p,rate:h})=>{i!=null&&setCurrentTime(i),p!=null&&setIsPaused(p),h=h||h};self.destroy=()=>{jassubObj.quitLibrary()};self.createEvent=({event:i})=>{_applyKeys(i,jassubObj.getEvent(jassubObj.allocEvent()))};self.getEvents=()=>{const i=[];for(let p=0;p<jassubObj.getEventCount();p++){const{Start:h,Duration:w,ReadOrder:m,Layer:T,Style:F,MarginL:C,MarginR:S,MarginV:j,Name:E,Text:k,Effect:O}=jassubObj.getEvent(p);i.push({Start:h,Duration:w,ReadOrder:m,Layer:T,Style:F,MarginL:C,MarginR:S,MarginV:j,Name:E,Text:k,Effect:O})}postMessage({target:"getEvents",events:i})};self.setEvent=({event:i,index:p})=>{_applyKeys(i,jassubObj.getEvent(p))};self.removeEvent=({index:i})=>{jassubObj.removeEvent(i)};self.createStyle=({style:i})=>{_applyKeys(i,jassubObj.getStyle(jassubObj.allocStyle()))};self.getStyles=()=>{const i=[];for(let p=0;p<jassubObj.getStyleCount();p++){const{Name:h,FontName:w,FontSize:m,PrimaryColour:T,SecondaryColour:F,OutlineColour:C,BackColour:S,Bold:j,Italic:E,Underline:k,StrikeOut:O,ScaleX:G,ScaleY:R,Spacing:fe,Angle:le,BorderStyle:x,Outline:ue,Shadow:Y,Alignment:ce,MarginL:de,MarginR:X,MarginV:_e,Encoding:$e,treat_fontname_as_pattern:Te,Blur:Pe,Justify:Fe}=jassubObj.getStyle(p);i.push({Name:h,FontName:w,FontSize:m,PrimaryColour:T,SecondaryColour:F,OutlineColour:C,BackColour:S,Bold:j,Italic:E,Underline:k,StrikeOut:O,ScaleX:G,ScaleY:R,Spacing:fe,Angle:le,BorderStyle:x,Outline:ue,Shadow:Y,Alignment:ce,MarginL:de,MarginR:X,MarginV:_e,Encoding:$e,treat_fontname_as_pattern:Te,Blur:Pe,Justify:Fe})}postMessage({target:"getStyles",time:Date.now(),styles:i})};self.setStyle=({style:i,index:p})=>{_applyKeys(i,jassubObj.getStyle(p))};self.removeStyle=({index:i})=>{jassubObj.removeStyle(i)};onmessage=({data:i})=>{if(self[i.target])self[i.target](i);else throw new Error("Unknown event target "+i.target)};
           