"use strict";async function Module(i={}){var u,f=i,h=(...t)=>console.log(...t),y=(...t)=>console.error(...t);function m(){A?.(f)}G=(t=>()=>{t(),self.wasmMemory=x,self.HEAPU8C=new Uint8ClampedArray(x.buffer),self.HEAPU8=new Uint8Array(x.buffer)})(G);function w(t){throw t}var A,C,T,F,M,E,O,ie,oe,le=!1;function G(){var t=x.buffer;C=new Int8Array(t),F=new Int16Array(t),T=new Uint8Array(t),M=new Uint16Array(t),E=new Int32Array(t),O=new Uint32Array(t),ie=new Float32Array(t),oe=new Float64Array(t)}function $e(){{var t=62914560;x=new WebAssembly.Memory({initial:t/65536,maximum:32768})}G()}$e();var X=t=>Xe(t),Q=()=>Qe(),x,fe=new TextDecoder,Z=(t,r,n,s)=>{var o=r+n;if(s)return o;for(;t[r]&&!(r>=o);)++r;return r},J=(t,r,n)=>{if(!t)return"";var s=Z(T,t,r,n);return fe.decode(T.subarray(t,s))},Ce=(t,r,n,s)=>w(`Assertion failed: ${J(t)}, at: `+[r?J(r):"unknown filename",n,s?J(s):"unknown function"]);function _e(t,r,n){return 0}var we=(t,r,n)=>{};function tr(t,r,n){return 0}function nr(t,r,n,s){}var ar=()=>w(""),sr=(t,r,n,s,o)=>{},k=t=>{for(var r="";;){var n=T[t++];if(!n)return r;r+=String.fromCharCode(n)}},q={},K={},ue={},N=class extends Error{constructor(r){super(r),this.name="BindingError"}},_=t=>{throw new N(t)};function ir(t,r,n={}){var s=r.name;if(t||_(`type "${s}" must have a positive integer typeid pointer`),K.hasOwnProperty(t)){if(n.ignoreDuplicateRegistrations)return;_(`Cannot register type '${s}' twice`)}if(K[t]=r,delete ue[t],q.hasOwnProperty(t)){var o=q[t];delete q[t],o.forEach(l=>l())}}function B(t,r,n={}){return ir(t,r,n)}var or=(t,r,n,s)=>{r=k(r),B(t,{name:r,fromWireType:function(o){return!!o},toWireType:function(o,l){return l?n:s},readValueFromPointer:function(o){return this.fromWireType(T[o])},destructorFunction:null})},lr=t=>({count:t.count,deleteScheduled:t.deleteScheduled,preservePointerOnDelete:t.preservePointerOnDelete,ptr:t.ptr,ptrType:t.ptrType,smartPtr:t.smartPtr,smartPtrType:t.smartPtrType}),Te=t=>{function r(n){return n.$$.ptrType.registeredClass.name}_(r(t)+" instance already deleted")},Pe=!1,Me=t=>{},fr=t=>{t.smartPtr?t.smartPtrType.rawDestructor(t.smartPtr):t.ptrType.registeredClass.rawDestructor(t.ptr)},We=t=>{t.count.value-=1;var r=t.count.value===0;r&&fr(t)},ee=t=>globalThis.FinalizationRegistry?(Pe=new FinalizationRegistry(r=>{We(r.$$)}),ee=r=>{var n=r.$$,s=!!n.smartPtr;if(s){var o={$$:n};Pe.register(r,o,r)}return r},Me=r=>Pe.unregister(r),ee(t)):(ee=r=>r,t),ce=[],ur=()=>{for(;ce.length;){var t=ce.pop();t.$$.deleteScheduled=!1,t.delete()}},Ee,cr=()=>{let t=de.prototype;Object.assign(t,{isAliasOf(n){if(!(this instanceof de)||!(n instanceof de))return!1;var s=this.$$.ptrType.registeredClass,o=this.$$.ptr;n.$$=n.$$;for(var l=n.$$.ptrType.registeredClass,p=n.$$.ptr;s.baseClass;)o=s.upcast(o),s=s.baseClass;for(;l.baseClass;)p=l.upcast(p),l=l.baseClass;return s===l&&o===p},clone(){if(this.$$.ptr||Te(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var n=ee(Object.create(Object.getPrototypeOf(this),{$$:{value:lr(this.$$)}}));return n.$$.count.value+=1,n.$$.deleteScheduled=!1,n},delete(){this.$$.ptr||Te(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_("Object already scheduled for deletion"),Me(this),We(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||Te(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&_("Object already scheduled for deletion"),ce.push(this),ce.length===1&&Ee&&Ee(ur),this.$$.deleteScheduled=!0,this}});const r=Symbol.dispose;r&&(t[r]=t.delete)};function de(){}var Re=(t,r)=>Object.defineProperty(r,"name",{value:t}),Ue={},ke=(t,r,n)=>{if(t[r].overloadTable===void 0){var s=t[r];t[r]=function(...o){return t[r].overloadTable.hasOwnProperty(o.length)||_(`Function '${n}' called with an invalid number of arguments (${o.length}) - expects one of (${t[r].overloadTable})!`),t[r].overloadTable[o.length].apply(this,o)},t[r].overloadTable=[],t[r].overloadTable[s.argCount]=s}},dr=(t,r,n)=>{f.hasOwnProperty(t)?((n===void 0||f[t].overloadTable!==void 0&&f[t].overloadTable[n]!==void 0)&&_(`Cannot register public name '${t}' twice`),ke(f,t,t),f[t].overloadTable.hasOwnProperty(n)&&_(`Cannot register multiple overloads of a function with the same number of arguments (${n})!`),f[t].overloadTable[n]=r):(f[t]=r,f[t].argCount=n)},vr=48,pr=57,gr=t=>{t=t.replace(/[^a-zA-Z0-9_]/g,"$");var r=t.charCodeAt(0);return r>=vr&&r<=pr?`_${t}`:t};function yr(t,r,n,s,o,l,p,v){this.name=t,this.constructor=r,this.instancePrototype=n,this.rawDestructor=s,this.baseClass=o,this.getActualType=l,this.upcast=p,this.downcast=v,this.pureVirtualFunctions=[]}var ve=(t,r,n)=>{for(;r!==n;)r.upcast||_(`Expected null or instance of ${n.name}, got an instance of ${r.name}`),t=r.upcast(t),r=r.baseClass;return t},Ae=t=>{if(t===null)return"null";var r=typeof t;return r==="object"||r==="array"||r==="function"?t.toString():""+t};function hr(t,r){if(r===null)return this.isReference&&_(`null is not a valid ${this.name}`),0;r.$$||_(`Cannot pass "${Ae(r)}" as a ${this.name}`),r.$$.ptr||_(`Cannot pass deleted object as a pointer of type ${this.name}`);var n=r.$$.ptrType.registeredClass,s=ve(r.$$.ptr,n,this.registeredClass);return s}function br(t,r){var n;if(r===null)return this.isReference&&_(`null is not a valid ${this.name}`),this.isSmartPointer?(n=this.rawConstructor(),t!==null&&t.push(this.rawDestructor,n),n):0;(!r||!r.$$)&&_(`Cannot pass "${Ae(r)}" as a ${this.name}`),r.$$.ptr||_(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&r.$$.ptrType.isConst&&_(`Cannot convert argument of type ${r.$$.smartPtrType?r.$$.smartPtrType.name:r.$$.ptrType.name} to parameter type ${this.name}`);var s=r.$$.ptrType.registeredClass;if(n=ve(r.$$.ptr,s,this.registeredClass),this.isSmartPointer)switch(r.$$.smartPtr===void 0&&_("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:r.$$.smartPtrType===this?n=r.$$.smartPtr:_(`Cannot convert argument of type ${r.$$.smartPtrType?r.$$.smartPtrType.name:r.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:n=r.$$.smartPtr;break;case 2:if(r.$$.smartPtrType===this)n=r.$$.smartPtr;else{var o=r.clone();n=this.rawShare(n,je.toHandle(()=>o.delete())),t!==null&&t.push(this.rawDestructor,n)}break;default:_("Unsupporting sharing policy")}return n}function mr(t,r){if(r===null)return this.isReference&&_(`null is not a valid ${this.name}`),0;r.$$||_(`Cannot pass "${Ae(r)}" as a ${this.name}`),r.$$.ptr||_(`Cannot pass deleted object as a pointer of type ${this.name}`),r.$$.ptrType.isConst&&_(`Cannot convert argument of type ${r.$$.ptrType.name} to parameter type ${this.name}`);var n=r.$$.ptrType.registeredClass,s=ve(r.$$.ptr,n,this.registeredClass);return s}function pe(t){return this.fromWireType(O[t>>2])}var Ie=(t,r,n)=>{if(r===n)return t;if(n.baseClass===void 0)return null;var s=Ie(t,r,n.baseClass);return s===null?null:n.downcast(s)},$r={},Cr=(t,r)=>{for(r===void 0&&_("ptr should not be undefined");t.baseClass;)r=t.upcast(r),t=t.baseClass;return r},_r=(t,r)=>(r=Cr(t,r),$r[r]),wr=class extends Error{constructor(r){super(r),this.name="InternalError"}},ge=t=>{throw new wr(t)},ye=(t,r)=>{(!r.ptrType||!r.ptr)&&ge("makeClassHandle requires ptr and ptrType");var n=!!r.smartPtrType,s=!!r.smartPtr;return n!==s&&ge("Both smartPtrType and smartPtr must be specified"),r.count={value:1},ee(Object.create(t,{$$:{value:r,writable:!0}}))};function Tr(t){var r=this.getPointee(t);if(!r)return this.destructor(t),null;var n=_r(this.registeredClass,r);if(n!==void 0){if(n.$$.count.value===0)return n.$$.ptr=r,n.$$.smartPtr=t,n.clone();var s=n.clone();return this.destructor(t),s}function o(){return this.isSmartPointer?ye(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:r,smartPtrType:this,smartPtr:t}):ye(this.registeredClass.instancePrototype,{ptrType:this,ptr:t})}var l=this.registeredClass.getActualType(r),p=Ue[l];if(!p)return o.call(this);var v;this.isConst?v=p.constPointerType:v=p.pointerType;var g=Ie(r,this.registeredClass,v.registeredClass);return g===null?o.call(this):this.isSmartPointer?ye(v.registeredClass.instancePrototype,{ptrType:v,ptr:g,smartPtrType:this,smartPtr:t}):ye(v.registeredClass.instancePrototype,{ptrType:v,ptr:g})}var Pr=()=>{Object.assign(he.prototype,{getPointee(t){return this.rawGetPointee&&(t=this.rawGetPointee(t)),t},destructor(t){this.rawDestructor?.(t)},readValueFromPointer:pe,fromWireType:Tr})};function he(t,r,n,s,o,l,p,v,g,$,P){this.name=t,this.registeredClass=r,this.isReference=n,this.isConst=s,this.isSmartPointer=o,this.pointeeType=l,this.sharingPolicy=p,this.rawGetPointee=v,this.rawConstructor=g,this.rawShare=$,this.rawDestructor=P,!o&&r.baseClass===void 0?s?(this.toWireType=hr,this.destructorFunction=null):(this.toWireType=mr,this.destructorFunction=null):this.toWireType=br}var Ar=(t,r,n)=>{f.hasOwnProperty(t)||ge("Replacing nonexistent public symbol"),f[t].overloadTable!==void 0&&n!==void 0?f[t].overloadTable[n]=r:(f[t]=r,f[t].argCount=n)},be={},jr=(t,r,n)=>{t=t.replace(/p/g,"i");var s=be[t];return s(r,...n)},De=[],re=t=>{var r=De[t];return r||(De[t]=r=Ze.get(t)),r},Fr=(t,r,n=[],s=!1)=>{if(t.includes("j"))return jr(t,r,n);var o=re(r),l=o(...n);function p(v){return v}return l},Sr=(t,r,n=!1)=>(...s)=>Fr(t,r,s,n),H=(t,r,n=!1)=>{t=k(t);function s(){if(t.includes("j"))return Sr(t,r);var l=re(r);return l}var o=s();return typeof o!="function"&&_(`unknown function pointer with signature ${t}: ${r}`),o};class Or extends Error{}var Mr=t=>{var r=Ke(t),n=k(r);return V(r),n},te=(t,r)=>{var n=[],s={};function o(l){if(!s[l]&&!K[l]){if(ue[l]){ue[l].forEach(o);return}n.push(l),s[l]=!0}}throw r.forEach(o),new Or(`${t}: `+n.map(Mr).join([", "]))},z=(t,r,n)=>{t.forEach(v=>ue[v]=r);function s(v){var g=n(v);g.length!==t.length&&ge("Mismatched type converter count");for(var $=0;$<t.length;++$)B(t[$],g[$])}var o=new Array(r.length),l=[],p=0;for(let[v,g]of r.entries())K.hasOwnProperty(g)?o[v]=K[g]:(l.push(g),q.hasOwnProperty(g)||(q[g]=[]),q[g].push(()=>{o[v]=K[g],++p,p===l.length&&s(o)}));l.length===0&&s(o)},Wr=(t,r,n,s,o,l,p,v,g,$,P,S,W)=>{P=k(P),l=H(o,l),v&&=H(p,v),$&&=H(g,$),W=H(S,W);var j=gr(P);dr(j,function(){te(`Cannot construct ${P} due to unbound types`,[s])}),z([t,r,n],s?[s]:[],R=>{R=R[0];var I,L;s?(I=R.registeredClass,L=I.instancePrototype):L=de.prototype;var D=Re(P,function(...Oe){if(Object.getPrototypeOf(this)!==se)throw new N(`Use 'new' to construct ${P}`);if(U.constructor_body===void 0)throw new N(`${P} has no accessible constructor`);var rr=U.constructor_body[Oe.length];if(rr===void 0)throw new N(`Tried to invoke ctor of ${P} with invalid number of parameters (${Oe.length}) - expected (${Object.keys(U.constructor_body).toString()}) parameters instead!`);return rr.apply(this,Oe)}),se=Object.create(L,{constructor:{value:D}});D.prototype=se;var U=new yr(P,D,se,W,I,l,v,$);U.baseClass&&(U.baseClass.__derivedClasses??=[],U.baseClass.__derivedClasses.push(U));var Ot=new he(P,U,!0,!1,!1),Ne=new he(P+"*",U,!1,!1,!1),er=new he(P+" const*",U,!1,!0,!1);return Ue[t]={pointerType:Ne,constPointerType:er},Ar(j,D),[Ot,Ne,er]})},xe=(t,r)=>{for(var n=[],s=0;s<t;s++)n.push(O[r+s*4>>2]);return n},Be=t=>{for(;t.length;){var r=t.pop(),n=t.pop();n(r)}};function Le(t){for(var r=1;r<t.length;++r)if(t[r]!==null&&t[r].destructorFunction===void 0)return!0;return!1}function Er(t,r,n,s){var o=Le(t),l=t.length-2,p=[],v=["fn"];r&&v.push("thisWired");for(var g=0;g<l;++g)p.push(`arg${g}`),v.push(`arg${g}Wired`);p=p.join(","),v=v.join(",");var $=`return function (${p}) {
`;o&&($+=`var destructors = [];
`);var P=o?"destructors":"null",S=["humanName","throwBindingError","invoker","fn","runDestructors","fromRetWire","toClassParamWire"];r&&($+=`var thisWired = toClassParamWire(${P}, this);
`);for(var g=0;g<l;++g){var W=`toArg${g}Wire`;$+=`var arg${g}Wired = ${W}(${P}, arg${g});
`,S.push(W)}if($+=(n||s?"var rv = ":"")+`invoker(${v});
`,o)$+=`runDestructors(destructors);
`;else for(var g=r?1:2;g<t.length;++g){var j=g===1?"thisWired":"arg"+(g-2)+"Wired";t[g].destructorFunction!==null&&($+=`${j}_dtor(${j});
`,S.push(`${j}_dtor`))}return n&&($+=`var ret = fromRetWire(rv);
return ret;
`),$+=`}
`,new Function(S,$)}function He(t,r,n,s,o,l){var p=r.length;p<2&&_("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var v=r[1]!==null&&n!==null,g=Le(r),$=!r[0].isVoid,P=r[0],S=r[1],W=[t,_,s,o,Be,P.fromWireType.bind(P),S?.toWireType.bind(S)],j=2;j<p;++j){var R=r[j];W.push(R.toWireType.bind(R))}if(!g)for(var j=v?1:2;j<r.length;++j)r[j].destructorFunction!==null&&W.push(r[j].destructorFunction);var L=Er(r,v,$,l)(...W);return Re(t,L)}var Rr=(t,r,n,s,o,l)=>{var p=xe(r,n);o=H(s,o),z([],[t],v=>{v=v[0];var g=`constructor ${v.name}`;if(v.registeredClass.constructor_body===void 0&&(v.registeredClass.constructor_body=[]),v.registeredClass.constructor_body[r-1]!==void 0)throw new N(`Cannot register multiple constructors with identical number of parameters (${r-1}) for class '${v.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return v.registeredClass.constructor_body[r-1]=()=>{te(`Cannot construct ${v.name} due to unbound types`,p)},z([],p,$=>($.splice(1,0,null),v.registeredClass.constructor_body[r-1]=He(g,$,null,o,l),[])),[]})},Ur=t=>{t=t.trim();const r=t.indexOf("(");return r===-1?t:t.slice(0,r)},kr=(t,r,n,s,o,l,p,v,g,$)=>{var P=xe(n,s);r=k(r),r=Ur(r),l=H(o,l,g),z([],[t],S=>{S=S[0];var W=`${S.name}.${r}`;r.startsWith("@@")&&(r=Symbol[r.substring(2)]),v&&S.registeredClass.pureVirtualFunctions.push(r);function j(){te(`Cannot call ${W} due to unbound types`,P)}var R=S.registeredClass.instancePrototype,I=R[r];return I===void 0||I.overloadTable===void 0&&I.className!==S.name&&I.argCount===n-2?(j.argCount=n-2,j.className=S.name,R[r]=j):(ke(R,r,W),R[r].overloadTable[n-2]=j),z([],P,L=>{var D=He(W,L,S,l,p,g);return R[r].overloadTable===void 0?(D.argCount=n-2,R[r]=D):R[r].overloadTable[n-2]=D,[]}),[]})},Ve=(t,r,n)=>(t instanceof Object||_(`${n} with invalid "this": ${t}`),t instanceof r.registeredClass.constructor||_(`${n} incompatible with "this" of type ${t.constructor.name}`),t.$$.ptr||_(`cannot call emscripten binding method ${n} on deleted object`),ve(t.$$.ptr,t.$$.ptrType.registeredClass,r.registeredClass)),Ir=(t,r,n,s,o,l,p,v,g,$)=>{r=k(r),o=H(s,o),z([],[t],P=>{P=P[0];var S=`${P.name}.${r}`,W={get(){te(`Cannot access ${S} due to unbound types`,[n,p])},enumerable:!0,configurable:!0};return g?W.set=()=>te(`Cannot access ${S} due to unbound types`,[n,p]):W.set=j=>_(S+" is a read-only property"),Object.defineProperty(P.registeredClass.instancePrototype,r,W),z([],g?[n,p]:[n],j=>{var R=j[0],I={get(){var D=Ve(this,P,S+" getter");return R.fromWireType(o(l,D))},enumerable:!0};if(g){g=H(v,g);var L=j[1];I.set=function(D){var se=Ve(this,P,S+" setter"),U=[];g($,se,L.toWireType(U,D)),Be(U)}}return Object.defineProperty(P.registeredClass.instancePrototype,r,I),[]}),[]})},ze=[],Y=[0,1,,1,null,1,!0,1,!1,1],Dr=t=>{t>9&&--Y[t+1]===0&&(Y[t]=void 0,ze.push(t))},je={toValue:t=>(t||_(`Cannot use deleted val. handle = ${t}`),Y[t]),toHandle:t=>{switch(t){case void 0:return 2;case null:return 4;case!0:return 6;case!1:return 8;default:{const r=ze.pop()||Y.length;return Y[r]=t,Y[r+1]=1,r}}}},xr={name:"emscripten::val",fromWireType:t=>{var r=je.toValue(t);return Dr(t),r},toWireType:(t,r)=>je.toHandle(r),readValueFromPointer:pe,destructorFunction:null},Br=t=>B(t,xr),Lr=(t,r)=>{switch(r){case 4:return function(n){return this.fromWireType(ie[n>>2])};case 8:return function(n){return this.fromWireType(oe[n>>3])};default:throw new TypeError(`invalid float width (${r}): ${t}`)}},Hr=(t,r,n)=>{r=k(r),B(t,{name:r,fromWireType:s=>s,toWireType:(s,o)=>o,readValueFromPointer:Lr(r,n),destructorFunction:null})},Vr=(t,r,n)=>{switch(r){case 1:return n?s=>C[s]:s=>T[s];case 2:return n?s=>F[s>>1]:s=>M[s>>1];case 4:return n?s=>E[s>>2]:s=>O[s>>2];default:throw new TypeError(`invalid integer width (${r}): ${t}`)}},zr=(t,r,n,s,o)=>{r=k(r);const l=s===0;let p=g=>g;if(l){var v=32-8*n;p=g=>g<<v>>>v,o=p(o)}B(t,{name:r,fromWireType:p,toWireType:(g,$)=>$,readValueFromPointer:Vr(r,n,s!==0),destructorFunction:null})},Gr=(t,r,n)=>{var s=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],o=s[r];function l(p){var v=O[p>>2],g=O[p+4>>2];return new o(C.buffer,g,v)}n=k(n),B(t,{name:n,fromWireType:l,readValueFromPointer:l},{ignoreDuplicateRegistrations:!0})},Jr=(t,r,n,s)=>{if(!(s>0))return 0;for(var o=n,l=n+s-1,p=0;p<t.length;++p){var v=t.codePointAt(p);if(v<=127){if(n>=l)break;r[n++]=v}else if(v<=2047){if(n+1>=l)break;r[n++]=192|v>>6,r[n++]=128|v&63}else if(v<=65535){if(n+2>=l)break;r[n++]=224|v>>12,r[n++]=128|v>>6&63,r[n++]=128|v&63}else{if(n+3>=l)break;r[n++]=240|v>>18,r[n++]=128|v>>12&63,r[n++]=128|v>>6&63,r[n++]=128|v&63,p++}}return r[n]=0,n-o},Ge=(t,r,n)=>Jr(t,T,r,n),Je=t=>{for(var r=0,n=0;n<t.length;++n){var s=t.charCodeAt(n);s<=127?r++:s<=2047?r+=2:s>=55296&&s<=57343?(r+=4,++n):r+=3}return r},qr=(t,r)=>{r=k(r),B(t,{name:r,fromWireType(n){var s=O[n>>2],o=n+4,l;return l=J(o,s,!0),V(n),l},toWireType(n,s){s instanceof ArrayBuffer&&(s=new Uint8Array(s));var o,l=typeof s=="string";l||ArrayBuffer.isView(s)&&s.BYTES_PER_ELEMENT==1||_("Cannot pass non-string to std::string"),l?o=Je(s):o=s.length;var p=Se(4+o+1),v=p+4;return O[p>>2]=o,l?Ge(s,v,o+1):T.set(s,v),n!==null&&n.push(V,p),p},readValueFromPointer:pe,destructorFunction(n){V(n)}})},Kr=new TextDecoder("utf-16le"),Yr=(t,r,n)=>{var s=t>>1,o=Z(M,s,r/2,n);return Kr.decode(M.subarray(s,o))},Xr=(t,r,n)=>{if(n??=2147483647,n<2)return 0;n-=2;for(var s=r,o=n<t.length*2?n/2:t.length,l=0;l<o;++l){var p=t.charCodeAt(l);F[r>>1]=p,r+=2}return F[r>>1]=0,r-s},Qr=t=>t.length*2,Zr=(t,r,n)=>{for(var s="",o=t>>2,l=0;!(l>=r/4);l++){var p=O[o+l];if(!p&&!n)break;s+=String.fromCodePoint(p)}return s},Nr=(t,r,n)=>{if(n??=2147483647,n<4)return 0;for(var s=r,o=s+n-4,l=0;l<t.length;++l){var p=t.codePointAt(l);if(p>65535&&l++,E[r>>2]=p,r+=4,r+4>o)break}return E[r>>2]=0,r-s},et=t=>{for(var r=0,n=0;n<t.length;++n){var s=t.codePointAt(n);s>65535&&n++,r+=4}return r},rt=(t,r,n)=>{n=k(n);var s,o,l;r===2?(s=Yr,o=Xr,l=Qr):(s=Zr,o=Nr,l=et),B(t,{name:n,fromWireType:p=>{var v=O[p>>2],g=s(p+4,v*r,!0);return V(p),g},toWireType:(p,v)=>{typeof v!="string"&&_(`Cannot pass non-string to C++ string type ${n}`);var g=l(v),$=Se(4+g+r);return O[$>>2]=g/r,o(v,$+4,g+r),p!==null&&p.push(V,$),$},readValueFromPointer:pe,destructorFunction(p){V(p)}})},tt=(t,r)=>{r=k(r),B(t,{isVoid:!0,name:r,fromWireType:()=>{},toWireType:(n,s)=>{}})},nt=()=>{},at=()=>{throw 1/0},ne={},st=t=>{t()},it=()=>performance.now(),ot=(t,r)=>{if(ne[t]&&(clearTimeout(ne[t].id),delete ne[t]),!r)return 0;var n=setTimeout(()=>{delete ne[t],st(()=>Ye(t,it()))},r);return ne[t]={id:n,timeout_ms:r},0},lt=()=>2147483648,ft=(t,r)=>Math.ceil(t/r)*r,ut=t=>{var r=x.buffer.byteLength,n=(t-r+65535)/65536|0;try{return x.grow(n),G(),1}catch{}},ct=t=>{var r=T.length;t>>>=0;var n=lt();if(t>n)return!1;for(var s=1;s<=4;s*=2){var o=r*(1+.2/s);o=Math.min(o,t+100663296);var l=Math.min(n,ft(Math.max(t,o),65536)),p=ut(l);if(p)return!0}return!1},Fe={},dt=()=>"./this.program",ae=()=>{if(!ae.strings){var t=(globalThis.navigator?.language??"C").replace("-","_")+".UTF-8",r={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:t,_:dt()};for(var n in Fe)Fe[n]===void 0?delete r[n]:r[n]=Fe[n];var s=[];for(var n in r)s.push(`${n}=${r[n]}`);ae.strings=s}return ae.strings},vt=(t,r)=>{var n=0,s=0;for(var o of ae()){var l=r+n;O[t+s>>2]=l,n+=Ge(o,l,1/0)+1,s+=4}return 0},pt=(t,r)=>{var n=ae();O[t>>2]=n.length;var s=0;for(var o of n)s+=Je(o)+1;return O[r>>2]=s,0},qe=t=>{throw`exit(${t})`},gt=qe,yt=t=>52,ht=(t,r,n,s)=>52;function bt(t,r,n,s,o){return 70}var mt=[null,[],[]],$t=(t,r=0,n,s)=>{var o=Z(t,r,n,s);return fe.decode(t.buffer?t.subarray(r,o):new Uint8Array(t.slice(r,o)))},Ct=(t,r)=>{var n=mt[t];r===0||r===10?((t===1?h:y)($t(n)),n.length=0):n.push(r)},_t=(t,r,n,s)=>{for(var o=0,l=0;l<n;l++){var p=O[r>>2],v=O[r+4>>2];r+=8;for(var g=0;g<v;g++)Ct(t,T[p+g]);o+=v}return O[s>>2]=o,0};cr(),Pr();var Se,V,Ke,Ye,me,Xe,Qe,Ze;function wt(t){Se=f._malloc=t.K,V=t.L,Ke=t.M,Ye=t.O,me=t.P,Xe=t.Q,Qe=t.R,be.viiiiji=t.S,be.jiji=t.T,be.jij=t.U,Ze=t.N}var Tt={b:Ce,k:_e,B:we,H:tr,l:nr,z:ar,r:sr,o:or,h:Wr,E:Rr,d:kr,c:Ir,I:Br,m:Hr,f:zr,e:Gr,n:qr,i:rt,p:tt,x:nt,v:at,y:ot,A:ct,C:vt,D:pt,j:gt,g:yt,G:ht,q:bt,F:_t,u:Pt,s:jt,t:At,a:x,w:qe};function Pt(t,r,n){var s=Q();try{return re(t)(r,n)}catch(o){if(X(s),o!==o+0)throw o;me(1,0)}}function At(t,r,n,s,o){var l=Q();try{return re(t)(r,n,s,o)}catch(p){if(X(l),p!==p+0)throw p;me(1,0)}}function jt(t,r,n,s){var o=Q();try{return re(t)(r,n,s)}catch(l){if(X(o),l!==l+0)throw l;me(1,0)}}function Ft(t){le=!0,t.J()}var St={a:Tt};return WebAssembly.instantiateStreaming(fetch("jassub-worker-modern.wasm"),St).then(t=>{var r=t.instance.exports;wt(r),Ft(r),m()}),le?u=f:u=new Promise((t,r)=>{A=t}),u}String.prototype.startsWith||(String.prototype.startsWith=function(i,u=0){return this.substring(u,i.length)===i});String.prototype.includes||(String.prototype.includes=function(i,u){return this.indexOf(i,u)!==-1});Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(i,u){return new Uint8Array(this.subarray(i,u))});function toAbsoluteIndex(i,u){const f=i>>0;return f<0?Math.max(f+u,0):Math.min(f,u)}Uint8Array.prototype.fill||(Int8Array.prototype.fill=Int16Array.prototype.fill=Int32Array.prototype.fill=Uint8Array.prototype.fill=Uint16Array.prototype.fill=Uint32Array.prototype.fill=Float32Array.prototype.fill=Float64Array.prototype.fill=Array.prototype.fill=function(i){if(this==null)throw new TypeError("this is null or not defined");const u=Object(this),f=u.length>>>0,h=arguments.length;let y=toAbsoluteIndex(h>1?arguments[1]:void 0,f);const m=h>2?arguments[2]:void 0,w=m===void 0?f:toAbsoluteIndex(m,f);for(;w>y;)u[y++]=i;return u});Uint8Array.prototype.copyWithin||(Int8Array.prototype.copyWithin=Int16Array.prototype.copyWithin=Int32Array.prototype.copyWithin=Uint8Array.prototype.copyWithin=Uint16Array.prototype.copyWithin=Uint32Array.prototype.copyWithin=Float32Array.prototype.copyWithin=Float64Array.prototype.copyWithin=Array.prototype.copyWithin=function(i,u){const f=Object(this),h=f.length>>>0;let y=toAbsoluteIndex(i,h),m=toAbsoluteIndex(u,h);const w=arguments.length>2?arguments[2]:void 0;let A=Math.min((w===void 0?h:toAbsoluteIndex(w,h))-m,h-y),C=1;for(m<y&&y<m+A&&(C=-1,m+=A-1,y+=A-1);A-- >0;)m in f?f[y]=f[m]:delete f[y],y+=C,m+=C;return f});Date.now||(Date.now=()=>new Date().getTime());"performance"in self||(self.performance={now:()=>Date.now()});if(typeof console>"u"){const i=(u,f)=>{postMessage({target:"console",command:u,content:JSON.stringify(Array.prototype.slice.call(f))})};self.console={log:function(){i("log",arguments)},debug:function(){i("debug",arguments)},info:function(){i("info",arguments)},warn:function(){i("warn",arguments)},error:function(){i("error",arguments)}},console.log("Detected lack of console, overridden console")}let promiseSupported=typeof Promise<"u";if(promiseSupported)try{let i;new Promise(u=>{i=u}),i()}catch{promiseSupported=!1}promiseSupported||(self.Promise=function(i){let u=()=>{};return i(f=>setTimeout(()=>u(f),0)),{then:f=>u=f}});const read_=(i,u)=>{const f=new XMLHttpRequest;return f.open("GET",i,!1),f.responseType=u?"arraybuffer":"text",f.send(null),f.response},readAsync=(i,u,f)=>{const h=new XMLHttpRequest;h.open("GET",i,!0),h.responseType="arraybuffer",h.onload=()=>{if((h.status===200||h.status===0)&&h.response)return u(h.response)},h.onerror=f,h.send(null)};let lastCurrentTime=0;const rate=1;let rafId=null,nextIsRaf=!1,lastCurrentTimeReceivedAt=Date.now(),targetFps=24,useLocalFonts=!1,blendMode="js",availableFonts={};const fontMap_={};let fontId=0,debug;self.width=0;self.height=0;let asyncRender=!1;self.addFont=({font:i})=>asyncWrite(i);const findAvailableFonts=i=>{i=i.trim().toLowerCase(),i.startsWith("@")&&(i=i.substring(1)),!fontMap_[i]&&(fontMap_[i]=!0,availableFonts[i]?asyncWrite(availableFonts[i]):useLocalFonts&&postMessage({target:"getLocalFont",font:i}))},asyncWrite=i=>{typeof i=="string"?readAsync(i,u=>{allocFont(new Uint8Array(u))},console.error):allocFont(i)},allocFont=i=>{const u=_malloc(i.byteLength);self.HEAPU8.set(i,u),jassubObj.addFont("font-"+fontId++,u,i.byteLength),jassubObj.reloadFonts()},processAvailableFonts=i=>{if(!availableFonts)return;const u=parseAss(i);for(let y=0;y<u.length;y++)for(let m=0;m<u[y].body.length;m++)u[y].body[m].key==="Style"&&findAvailableFonts(u[y].body[m].value.Fontname);const f=/\\fn([^\\}]*?)[\\}]/g;let h;for(;(h=f.exec(i))!==null;)findAvailableFonts(h[1])};self.setTrack=({content:i})=>{processAvailableFonts(i),dropAllBlur&&(i=dropBlur(i)),jassubObj.createTrackMem(i),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],postMessage({target:"verifyColorSpace",subtitleColorSpace})};self.getColorSpace=()=>postMessage({target:"verifyColorSpace",subtitleColorSpace});self.freeTrack=()=>{jassubObj.removeTrack()};self.setTrackByUrl=({url:i})=>{self.setTrack({content:read_(i)})};const getCurrentTime=()=>{const i=(Date.now()-lastCurrentTimeReceivedAt)/1e3;return _isPaused?lastCurrentTime:(i>5&&(console.error("Didn't received currentTime > 5 seconds. Assuming video was paused."),setIsPaused(!0)),lastCurrentTime+i*rate)},setCurrentTime=i=>{lastCurrentTime=i,lastCurrentTimeReceivedAt=Date.now(),rafId||(nextIsRaf?rafId=requestAnimationFrame(renderLoop):(renderLoop(),setTimeout(()=>{nextIsRaf=!1},20)))};let _isPaused=!0;const setIsPaused=i=>{i!==_isPaused&&(_isPaused=i,i?rafId&&(clearTimeout(rafId),rafId=null):(lastCurrentTimeReceivedAt=Date.now(),rafId=requestAnimationFrame(renderLoop)))},a="BT601",b="BT709",c="SMPTE240M",d="FCC",libassYCbCrMap=[null,a,null,a,a,b,b,c,c,d,d],render=(i,u)=>{const f={},h=performance.now(),y=blendMode==="wasm"?jassubObj.renderBlend(i,u||0):jassubObj.renderImage(i,u||0);if(debug){const m=performance.now();f.WASMRenderTime=m-h,f.JSRenderTime=performance.now()}if(jassubObj.changed!==0||u){const m=[],w=[];if(!y)return paintImages({images:m,buffers:w,times:f});if(asyncRender){const A=[];for(let C=y,T=0;T<jassubObj.count;C=C.next,++T){const F={w:C.w,h:C.h,x:C.x,y:C.y},M=C.image,E=hasBitmapBug?self.HEAPU8C.slice(M,M+F.w*F.h*4):self.HEAPU8C.subarray(M,M+F.w*F.h*4);A.push(createImageBitmap(new ImageData(E,F.w,F.h))),m.push(F)}Promise.all(A).then(C=>{for(let T=0;T<m.length;T++)m[T].image=C[T];debug&&(f.JSRenderTime=performance.now()-f.JSRenderTime),paintImages({images:m,buffers:C,times:f})})}else{for(let A=y,C=0;C<jassubObj.count;A=A.next,++C){const T={w:A.w,h:A.h,x:A.x,y:A.y,image:A.image};if(!offCanvasCtx){const F=self.wasmMemory.buffer.slice(A.image,A.image+A.w*A.h*4);w.push(F),T.image=F}m.push(T)}paintImages({images:m,buffers:w,times:f})}}else postMessage({target:"unbusy"})};self.demand=({time:i})=>{lastCurrentTime=i,render(i)};const renderLoop=i=>{rafId=0,render(getCurrentTime(),i),_isPaused||(rafId=requestAnimationFrame(renderLoop))},paintImages=({times:i,images:u,buffers:f})=>{const h={target:"render",asyncRender,images:u,times:i,width:self.width,height:self.height,colorSpace:subtitleColorSpace};if(offscreenRender){(offCanvas.height!==self.height||offCanvas.width!==self.width)&&(offCanvas.width=self.width,offCanvas.height=self.height),offCanvasCtx.clearRect(0,0,self.width,self.height);for(const y of u)y.image&&(asyncRender?(offCanvasCtx.drawImage(y.image,y.x,y.y),y.image.close()):(bufferCanvas.width=y.w,bufferCanvas.height=y.h,bufferCtx.putImageData(new ImageData(self.HEAPU8C.subarray(y.image,y.image+y.w*y.h*4),y.w,y.h),0,0),offCanvasCtx.drawImage(bufferCanvas,y.x,y.y)));if(offscreenRender==="hybrid"){if(!u.length)return postMessage(h);debug&&(i.bitmaps=u.length);try{const y=offCanvas.transferToImageBitmap();h.images=[{image:y,x:0,y:0}],h.asyncRender=!0,postMessage(h,[y])}catch{postMessage({target:"unbusy"})}}else{if(debug){let y=0;for(const m in i)y+=i[m];console.log("Bitmaps: "+u.length+" Total: "+(y|0)+"ms",i)}postMessage({target:"unbusy"})}}else postMessage(h,f)},parseAss=i=>{let u,f,h,y,m,w,A,C,T,F;const M=[],E=i.split(/[\r\n]+/g);for(C=0;C<E.length;C++)if(u=E[C].match(/^\[(.*)\]$/),u)f=null,M.push({name:u[1],body:[]});else{if(/^\s*$/.test(E[C])||M.length===0)continue;if(F=M[M.length-1].body,E[C][0]===";")F.push({type:"comment",value:E[C].substring(1)});else{if(y=E[C].split(":"),m=y[0],w=y.slice(1).join(":").trim(),(f||m==="Format")&&(w=w.split(","),f&&w.length>f.length&&(h=w.slice(f.length-1).join(","),w=w.slice(0,f.length-1),w.push(h)),w=w.map(O=>O.trim()),f)){for(A={},T=0;T<w.length;T++)A[f[T]]=w[T];w=A}m==="Format"&&(f=w),F.push({key:m,value:w})}}return M},blurRegex=/\\blur(?:[0-9]+\.)?[0-9]+/gm,dropBlur=i=>i.replace(blurRegex,""),requestAnimationFrame=(()=>{let i=0;return u=>{const f=Date.now();if(i===0)i=f+1e3/targetFps;else for(;f+2>=i;)i+=1e3/targetFps;const h=Math.max(i-f,0);return setTimeout(u,h)}})(),_applyKeys=(i,u)=>{for(const f of Object.keys(i))u[f]=i[f]};let offCanvas,offCanvasCtx,offscreenRender,bufferCanvas,bufferCtx,jassubObj,subtitleColorSpace,dropAllBlur,_malloc,hasBitmapBug;self.init=data=>{hasBitmapBug=data.hasBitmapBug;try{const i=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(!(i instanceof WebAssembly.Module)||!(new WebAssembly.Instance(i)instanceof WebAssembly.Instance))throw new Error("WASM not supported")}catch(e){console.warn(e),eval(read_(data.legacyWasmUrl))}if(WebAssembly.instantiateStreaming){const i=self.fetch;self.fetch=u=>i(data.wasmUrl)}Module({wasm:!WebAssembly.instantiateStreaming&&read_(data.wasmUrl,!0)}).then(i=>{_malloc=i._malloc,self.width=data.width,self.height=data.height,blendMode=data.blendMode,asyncRender=data.asyncRender,asyncRender&&typeof createImageBitmap>"u"&&(asyncRender=!1,console.error("'createImageBitmap' needed for 'asyncRender' unsupported!")),availableFonts=data.availableFonts,debug=data.debug,targetFps=data.targetFps||targetFps,useLocalFonts=data.useLocalFonts,dropAllBlur=data.dropAllBlur;const u=data.fallbackFont.toLowerCase();jassubObj=new i.JASSUB(self.width,self.height,u||null,debug),u&&findAvailableFonts(u);let f=data.subContent;f||(f=read_(data.subUrl)),processAvailableFonts(f),dropAllBlur&&(f=dropBlur(f));for(const h of data.fonts||[])asyncWrite(h);jassubObj.createTrackMem(f),subtitleColorSpace=libassYCbCrMap[jassubObj.trackColorSpace],jassubObj.setDropAnimations(data.dropAllAnimations||0),(data.libassMemoryLimit>0||data.libassGlyphLimit>0)&&jassubObj.setMemoryLimits(data.libassGlyphLimit||0,data.libassMemoryLimit||0),postMessage({target:"ready"}),postMessage({target:"verifyColorSpace",subtitleColorSpace})})};self.offscreenCanvas=({transferable:i})=>{offCanvas=i[0],offCanvasCtx=offCanvas.getContext("2d"),asyncRender||(bufferCanvas=new OffscreenCanvas(self.height,self.width),bufferCtx=bufferCanvas.getContext("2d",{desynchronized:!0})),offscreenRender=!0};self.detachOffscreen=()=>{offCanvas=new OffscreenCanvas(self.height,self.width),offCanvasCtx=offCanvas.getContext("2d",{desynchronized:!0}),offscreenRender="hybrid"};self.canvas=({width:i,height:u,videoWidth:f,videoHeight:h,force:y})=>{if(i==null)throw new Error("Invalid canvas size specified");self.width=i,self.height=u,jassubObj&&jassubObj.resizeCanvas(i,u,f,h),y&&render(lastCurrentTime,!0)};self.video=({currentTime:i,isPaused:u,rate:f})=>{i!=null&&setCurrentTime(i),u!=null&&setIsPaused(u),f=f||f};self.destroy=()=>{jassubObj.quitLibrary()};self.createEvent=({event:i})=>{_applyKeys(i,jassubObj.getEvent(jassubObj.allocEvent()))};self.getEvents=()=>{const i=[];for(let u=0;u<jassubObj.getEventCount();u++){const{Start:f,Duration:h,ReadOrder:y,Layer:m,Style:w,MarginL:A,MarginR:C,MarginV:T,Name:F,Text:M,Effect:E}=jassubObj.getEvent(u);i.push({Start:f,Duration:h,ReadOrder:y,Layer:m,Style:w,MarginL:A,MarginR:C,MarginV:T,Name:F,Text:M,Effect:E})}postMessage({target:"getEvents",events:i})};self.setEvent=({event:i,index:u})=>{_applyKeys(i,jassubObj.getEvent(u))};self.removeEvent=({index:i})=>{jassubObj.removeEvent(i)};self.createStyle=({style:i})=>{const u=jassubObj.getStyle(jassubObj.allocStyle());return _applyKeys(i,u),u};self.getStyles=()=>{const i=[];for(let u=0;u<jassubObj.getStyleCount();u++){const{Name:f,FontName:h,FontSize:y,PrimaryColour:m,SecondaryColour:w,OutlineColour:A,BackColour:C,Bold:T,Italic:F,Underline:M,StrikeOut:E,ScaleX:O,ScaleY:ie,Spacing:oe,Angle:le,BorderStyle:G,Outline:$e,Shadow:X,Alignment:Q,MarginL:x,MarginR:fe,MarginV:Z,Encoding:J,treat_fontname_as_pattern:Ce,Blur:_e,Justify:we}=jassubObj.getStyle(u);i.push({Name:f,FontName:h,FontSize:y,PrimaryColour:m,SecondaryColour:w,OutlineColour:A,BackColour:C,Bold:T,Italic:F,Underline:M,StrikeOut:E,ScaleX:O,ScaleY:ie,Spacing:oe,Angle:le,BorderStyle:G,Outline:$e,Shadow:X,Alignment:Q,MarginL:x,MarginR:fe,MarginV:Z,Encoding:J,treat_fontname_as_pattern:Ce,Blur:_e,Justify:we})}postMessage({target:"getStyles",time:Date.now(),styles:i})};self.setStyle=({style:i,index:u})=>{_applyKeys(i,jassubObj.getStyle(u))};self.removeStyle=({index:i})=>{jassubObj.removeStyle(i)};self.styleOverride=i=>{jassubObj.styleOverride(self.createStyle(i))};self.disableStyleOverride=()=>{jassubObj.disableStyleOverride()};self.defaultFont=({font:i})=>{jassubObj.setDefaultFont(i)};onmessage=({data:i})=>{if(self[i.target])self[i.target](i);else throw new Error("Unknown event target "+i.target)};
